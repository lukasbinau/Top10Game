<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Top10 Game</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app">

    <!-- Audio toggle â€“ always visible -->
    <button id="audio-toggle" class="audio-toggle" title="Toggle sound">ğŸ”Š</button>

    <!-- â•â•â•â•â•â•â• PHASE: Setup â•â•â•â•â•â•â• -->
    <section id="setup-area" class="phase">
      <header class="header">
        <h1 class="title">Top10 Game</h1>
        <p class="subtitle">First is fine. Tenth is better.</p>
      </header>

      <div class="setup-section">
        <h2 class="section-heading">Choose Category</h2>
        <div id="category-grid" class="category-grid">
          <!-- populated by Python -->
        </div>
      </div>

      <div class="setup-section">
        <h2 class="section-heading">Add Teams <span class="muted-sm">(2â€“8)</span></h2>
        <div class="team-input-row">
          <input id="team-name-input" class="input" placeholder="Team nameâ€¦"
                 autocomplete="off" maxlength="20" />
          <button id="add-team-btn" class="btn-icon" title="Add team">âœ“</button>
        </div>
        <div id="team-list" class="team-list"></div>
      </div>

      <button id="start-btn" class="btn btn-start hidden">ğŸ® Start Game</button>
    </section>

    <!-- â•â•â•â•â•â•â• PHASE: Hand-off â•â•â•â•â•â•â• -->
    <section id="handoff-area" class="phase phase-center hidden">
      <div class="handoff-emoji">ğŸ‘‹</div>
      <h2 class="handoff-label">Pass the phone to</h2>
      <div id="handoff-team" class="handoff-team">â€”</div>
      <div id="handoff-round" class="handoff-round">Round 1 of 10</div>
      <div id="handoff-dots" class="dots-row"></div>
      <button id="handoff-ready-btn" class="btn btn-ready">I'm Ready!</button>
    </section>

    <!-- â•â•â•â•â•â•â• PHASE: Turn (guessing) â•â•â•â•â•â•â• -->
    <section id="game-area" class="phase hidden">
      <div id="turn-banner" class="turn-banner">
        <div id="turn-team" class="turn-team">â€”</div>
        <div id="turn-round" class="turn-round">Round 1 of 10</div>
      </div>

      <div id="turn-dots" class="dots-row dots-sm"></div>

      <div class="prompt-area">
        <h2 id="prompt" class="prompt">â€¦</h2>
      </div>

      <div class="guess-area">
        <input id="guess-input" class="input input-guess"
               placeholder="Type your answerâ€¦" autocomplete="off" />
        <button id="submit-btn" class="btn btn-submit">Submit Guess</button>
      </div>

      <!-- Kebab menu button -->
      <button id="menu-btn" class="fab fab-left" title="Menu">â‹®</button>

      <!-- Menu overlay -->
      <div id="game-menu" class="menu-overlay hidden">
        <div class="menu-backdrop" id="menu-backdrop"></div>
        <div class="menu-sheet">
          <button id="skip-btn"    class="menu-item">â­&ensp;Skip Question</button>
          <button id="scores-btn"  class="menu-item">ğŸ“Š&ensp;View Scores</button>
          <button id="new-game-btn" class="menu-item menu-item-danger">ğŸ”„&ensp;New Game</button>
        </div>
      </div>
    </section>

    <!-- â•â•â•â•â•â•â• PHASE: Reveal â•â•â•â•â•â•â• -->
    <section id="result-area" class="phase hidden"></section>

    <!-- â•â•â•â•â•â•â• Scoreboard sheet overlay â•â•â•â•â•â•â• -->
    <div id="sb-overlay" class="sheet-overlay hidden">
      <div class="sheet-backdrop" id="sb-backdrop"></div>
      <div class="sheet-panel">
        <div class="sheet-handle"></div>
        <h3 class="sheet-heading">ğŸ“Š Scoreboard</h3>
        <div id="scoreboard" class="scoreboard"></div>
        <button id="sb-close" class="btn" style="margin-top:14px">Close</button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â• Winner overlay â•â•â•â•â•â•â• -->
    <div id="winner-overlay" class="winner-overlay hidden">
      <div class="winner-content">
        <div id="winner-trophy" class="winner-trophy">ğŸ†</div>
        <h1 id="winner-title" class="winner-title">Winner!</h1>
        <div id="winner-name" class="winner-name">â€”</div>
        <div id="winner-score" class="winner-score">0 pts</div>
        <div class="winner-divider"></div>
        <h3 class="winner-sb-title">Final Standings</h3>
        <div id="winner-scoreboard" class="winner-scoreboard"></div>
        <button id="winner-new-game-btn" class="btn winner-btn">New Game</button>
      </div>
    </div>

  </div>

  <!-- Hidden debug status -->
  <div id="status" style="display:none"></div>

  <script src="./sounds.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

  <script>
    const statusEl = document.getElementById("status");
    function setStatus(msg) { statusEl.textContent = msg; }

    async function boot() {
      try {
        setStatus("Loading Pythonâ€¦");
        const pyodide = await loadPyodide();

        const [mainPy, promptsJson] = await Promise.all([
          fetch("./main.py").then(r => r.text()),
          fetch("./prompts.json").then(r => r.text())
        ]);
        pyodide.FS.writeFile("main.py", mainPy);
        pyodide.FS.writeFile("prompts.json", promptsJson);

        await pyodide.runPythonAsync("import main\nmain.init()");
        setStatus("Ready âœ…");
      } catch (err) {
        setStatus("BOOT ERROR:\n" + err);
        console.error(err);
      }
    }
    boot();

    // Audio toggle
    document.getElementById("audio-toggle").addEventListener("click", () => {
      const m = window.GameAudio.toggleMute();
      document.getElementById("audio-toggle").textContent = m ? "ğŸ”‡" : "ğŸ”Š";
    });

    // Menu toggle
    document.getElementById("menu-btn").addEventListener("click", () => {
      document.getElementById("game-menu").classList.toggle("hidden");
    });
    document.getElementById("menu-backdrop").addEventListener("click", () => {
      document.getElementById("game-menu").classList.add("hidden");
    });

    // Scoreboard sheet close
    document.getElementById("sb-backdrop").addEventListener("click", () => {
      document.getElementById("sb-overlay").classList.add("hidden");
    });
    document.getElementById("sb-close").addEventListener("click", () => {
      document.getElementById("sb-overlay").classList.add("hidden");
    });
  </script>
</body>
</html>
